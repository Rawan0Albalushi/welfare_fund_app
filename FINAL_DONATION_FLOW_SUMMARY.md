# ููุฎุต ููุงุฆู ูุชุญุฏูุซ ุชุฏูู ุงูุชุจุฑุน

## โ ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ ุจูุฌุงุญ

ุชู ุชุทุจูู ุฌููุน ุงููุชุทูุจุงุช ุงููุทููุจุฉ ุนูู ุชุฏูู ุงูุชุจุฑุน ุจูุฌุงุญ:

### 1. ุนูุฏ ุงูุถุบุท ุนูู "ุชุจุฑุน":
- โ **ุงุณุชุฏุนุงุก POST /api/v1/payments/create** ูุน `donation_id` ู `amount`
- โ **ุชุฎุฒูู session_id ู checkout_url** ูู ุงูุงุณุชุฌุงุจุฉ
- โ **ูุชุญ CheckoutWebView** ูุน URLs ุงูุตุญูุญุฉ
- โ **ูุนุงูุฌุฉ ุงููุชุงุฆุฌ** ุจูุงุกู ุนูู `result.status`

### 2. ูุนุงูุฌุฉ ุงููุฌุงุญ:
- โ **ุงูุชุญูู ูู result.status == 'success'**
- โ **ุงุณุชุฏุนุงุก POST /api/v1/payments/confirm** ูุน `session_id`
- โ **ุนุฑุถ ุดุงุดุฉ "ูุฌุงุญ ุงูุชุจุฑุน"** ูุน ุฑุณุงูุฉ ููุงุณุจุฉ

### 3. ูุนุงูุฌุฉ ุงูุฅูุบุงุก:
- โ **ุงูุชุญูู ูู result.status == 'cancel'**
- โ **ุนุฑุถ ุฑุณุงูุฉ ุฅูุบุงุก ููุท** (ุจุฏูู ุดุงุดุฉ ูุดู)

### 4. ูุชุทูุจุงุช ุฅุถุงููุฉ:
- โ **ุนุฏู ุฅุถุงูุฉ session_id ููู successUrl** - ููุง ูู ูุทููุจ
- โ **ุงูุงุนุชูุงุฏ ุนูู session_id ุงููุฎุฒู** ูู ุงูุชุทุจูู
- โ **ุฏุนู Android ููุฌูุงุฒ ุงูุญูููู** ูุน adb reverse

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

### `lib/screens/checkout_webview.dart`
```dart
class CheckoutWebView extends StatefulWidget {
  final String checkoutUrl;
  final String successUrl;
  final String cancelUrl;
  
  // ูุนุงูุฌุฉ ุดุงููุฉ ูููุฌุงุญ ูุงูุฅูุบุงุก
  // ุฏุนู ูุชุนุฏุฏ ุงูููุตุงุช (Android, iOS, Web)
  // ุฅุฑุฌุงุน ุงููุชุงุฆุฌ ุจุตูุบุฉ {'status': 'success'/'cancel'}
}
```

## ๐ง ุงููููุงุช ุงููุญุฏุซุฉ

### `lib/screens/donation_screen.dart`
```dart
// ุชุญุฏูุซ ุฏุงูุฉ _makeDonation()
Future<void> _makeDonation() async {
  // 1. ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
  // 2. ุงุณุชุฏุนุงุก POST /api/v1/payments/create
  // 3. ูุชุญ CheckoutWebView
  // 4. ูุนุงูุฌุฉ ุงููุชุงุฆุฌ
}

// ุฏุงูุฉ ุชุฃููุฏ ุงูุฏูุน
Future<void> _confirmPayment(String sessionId) async {
  // ุงุณุชุฏุนุงุก POST /api/v1/payments/confirm
}

// ุนุฑุถ ุดุงุดุฉ ุงููุฌุงุญ
void _showDonationSuccess() {
  // ุญูุงุฑ ูุฌุงุญ ุงูุชุจุฑุน
}

// ุนุฑุถ ุฑุณุงูุฉ ุงูุฅูุบุงุก
void _showCancelMessage() {
  // ุฑุณุงูุฉ ุฅูุบุงุก ุจุณูุทุฉ
}
```

## ๐ URLs ุงููุณุชุฎุฏูุฉ

- **API Base:** `http://192.168.1.21:8000/api/v1`
- **Create Payment:** `POST /payments/create`
- **Confirm Payment:** `POST /payments/confirm`
- **Success URL:** `http://192.168.1.21:8000/api/v1/payments/success`
- **Cancel URL:** `http://192.168.1.21:8000/api/v1/payments/cancel`

## ๐ฑ ุฏุนู ุงูููุตุงุช

### Android (ุฌูุงุฒ ุญูููู)
```bash
adb reverse tcp:8000 tcp:8000
```

### iOS
- ูุนูู ุชููุงุฆูุงู ูุน localhost

### Web
- ููุชุญ ุตูุญุฉ ุงูุฏูุน ูู ุงููุชุตูุญ
- ูุนุงูุฌุฉ ุชููุงุฆูุฉ ูููุชุงุฆุฌ

## ๐ ุชุฏูู ุงูุนูู ุงููุงูู

```mermaid
graph TD
    A[ุงููุณุชุฎุฏู ูููุฃ ุจูุงูุงุช ุงูุชุจุฑุน] --> B[ุงูุถุบุท ุนูู "ุชุจุฑุน ุงูุขู"]
    B --> C[POST /api/v1/payments/create]
    C --> D[ุชุฎุฒูู session_id ู checkout_url]
    D --> E[ูุชุญ CheckoutWebView]
    E --> F{ูุชูุฌุฉ ุงูุฏูุน}
    F -->|success| G[POST /api/v1/payments/confirm]
    F -->|cancel| H[ุนุฑุถ ุฑุณุงูุฉ ุฅูุบุงุก]
    G --> I[ุนุฑุถ ุดุงุดุฉ ูุฌุงุญ ุงูุชุจุฑุน]
    H --> J[ุงูุนูุฏุฉ ููุดุงุดุฉ ุงูุณุงุจูุฉ]
    I --> J
```

## โ ุงููุชุงุฆุฌ ุงููุญููุฉ

1. **ุชุฏูู ุฏูุน ูุญุณู** - ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ ููุชุณูุฉ
2. **ูุนุงูุฌุฉ ุดุงููุฉ** - ุฌููุน ุญุงูุงุช ุงูุฏูุน ูุบุทุงุฉ
3. **ุฑุณุงุฆู ูุงุถุญุฉ** - ุงููุณุชุฎุฏู ูููู ูุง ูุญุฏุซ ูู ูู ุฎุทูุฉ
4. **ุฏุนู ูุชุนุฏุฏ ุงูููุตุงุช** - ูุนูู ุนูู Android, iOS, Web
5. **ุฃูุงู ูุญุณู** - ุงูุงุนุชูุงุฏ ุนูู session_id ุงููุฎุฒู
6. **ููุฏ ูุธูู** - ุจููุฉ ูุงุถุญุฉ ููุงุจูุฉ ููุตูุงูุฉ

## ๐ฏ ุงูุงุณุชุฎุฏุงู

ุงูุขู ูููู ูููุณุชุฎุฏููู:
1. ููุก ุจูุงูุงุช ุงูุชุจุฑุน
2. ุงูุถุบุท ุนูู "ุชุจุฑุน ุงูุขู"
3. ุฅุชูุงู ุงูุฏูุน ูู WebView
4. ุงูุญุตูู ุนูู ุชุฃููุฏ ููุฑู ูููุฌุงุญ ุฃู ุงูุฅูุบุงุก
5. ุชุฌุฑุจุฉ ุณูุณุฉ ููุชุณูุฉ ุนุจุฑ ุฌููุน ุงูููุตุงุช

## ๐ ููุงุญุธุงุช ูููุฉ

- โ ุฌููุน ุงููุชุทูุจุงุช ุชู ุชุทุจูููุง
- โ ุงูููุฏ ููุฑ ูุญุต Flutter analyze ุจูุฌุงุญ
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ุงูููุฏ ุงูุฌุฏูุฏ
- โ ุงูุชูุงูู ูุน ุงูุจุงููุฏ ููุฌูุฏ ููุคูุฏ
- โ ุฏุนู ูุงูู ููููุตุงุช ุงููุฎุชููุฉ
