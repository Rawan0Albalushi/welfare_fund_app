# ๐ง ุฅุตูุงุญ endpoint ุงูุชุจุฑุน ููุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ

## ๐ฏ ุงููุดููุฉ ุงููุญูููุฉ

ุชู ุฅุตูุงุญ ูุดููุฉ ุนุฏู ุฑุจุท ุงูุชุจุฑุน ุจุงููุณุชุฎุฏู ูู ุฎูุงู:
1. **ุชุบููุฑ endpoint ุงููุณุชุฎุฏู**
2. **ุชุญุณูู ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ**

---

## โ ุงููุดููุฉ ุงูุณุงุจูุฉ

### **ุงูุณุจุจ:**
```dart
// ูู donation_screen.dart - endpoint ุฎุงุทุฆ
final response = await http.post(
  Uri.parse('http://192.168.1.21:8000/api/v1/payments/create'),  // โ ุฎุทุฃ
  // ...
);
```

### **ุงููุชูุฌุฉ:**
- โ ุงูุชุจุฑุน ูุง ูุชู ุฑุจุทู ุจู user_id
- โ ุงููุณุชุฎุฏู ุงููุณุฌู ูุง ูุฑู ุชุจุฑุนู ูู "ุชุจุฑุนุงุชู"
- โ ุงูุจูุงูุงุช ูุง ุชุธูุฑ ุจุดูู ุตุญูุญ

---

## โ ุงูุญู ุงููุทุจู

### **1. ุชุบููุฑ Endpoint:**

#### **ูุจู ุงูุฅุตูุงุญ:**
```dart
// โ endpoint ุฎุงุทุฆ
Uri.parse('http://192.168.1.21:8000/api/v1/payments/create')
```

#### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```dart
// โ endpoint ุตุญูุญ
Uri.parse('http://192.168.1.21:8000/api/v1/donations/with-payment')
```

### **2. ุชุญุณูู ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ:**

#### **ูุจู ุงูุฅุตูุงุญ:**
```dart
final data = jsonDecode(response.body);
final sessionId = data['session_id'];        // โ ูุฏ ูููู null
final checkoutUrl = data['checkout_url'];    // โ ูุฏ ูููู null
```

#### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```dart
final data = jsonDecode(response.body);
print('โ Donation response: $data');  // โ ุชุณุฌูู ุงูุงุณุชุฌุงุจุฉ

// ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู ุงูุงุณุชุฌุงุจุฉ ูุน fallback
final sessionId = data['session_id'] ?? data['data']?['session_id'];
final checkoutUrl = data['checkout_url'] ?? 
                   data['data']?['checkout_url'] ?? 
                   data['payment_url'];

print('โ Payment session created: sessionId=$sessionId, checkoutUrl=$checkoutUrl');
```

---

## ๐ ุงููุฑู ุจูู ุงูู Endpoints

### **`/api/v1/payments/create`:**
- โ ูุง ููุดุฆ ุชุจุฑุน ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุง ูุฑุจุท ุงูุชุจุฑุน ุจู user_id
- โ ููุดุฆ ุฌูุณุฉ ุฏูุน ููุท
- โ ูุง ูุญูุธ ุจูุงูุงุช ุงููุชุจุฑุน

### **`/api/v1/donations/with-payment`:**
- โ ููุดุฆ ุชุจุฑุน ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุฑุจุท ุงูุชุจุฑุน ุจู user_id ูููุณุชุฎุฏููู ุงููุณุฌููู
- โ ููุดุฆ ุฌูุณุฉ ุฏูุน
- โ ูุญูุธ ุจูุงูุงุช ุงููุชุจุฑุน
- โ ูุฏุนู ุงูุชุจุฑุนุงุช ุงููุฌูููุฉ

---

## ๐ ุจููุฉ ุงูุงุณุชุฌุงุจุฉ ุงููุชููุนุฉ

### **ูู `/api/v1/donations/with-payment`:**
```json
{
  "success": true,
  "data": {
    "donation": {
      "id": "DN_xxx",
      "user_id": 123,  // โ ูุฑุจูุท ุจุงููุณุชุฎุฏู
      "campaign_id": 1,
      "amount": 5.00,
      "status": "pending"
    },
    "session_id": "checkout_xxx",
    "checkout_url": "https://checkout.thawani.om/xxx"
  },
  "message": "ุชู ุฅูุดุงุก ุงูุชุจุฑุน ุจูุฌุงุญ"
}
```

### **ุฃู:**
```json
{
  "success": true,
  "session_id": "checkout_xxx",
  "checkout_url": "https://checkout.thawani.om/xxx",
  "donation_id": "DN_xxx"
}
```

---

## ๐ฏ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### **1. ุฑุจุท ุตุญูุญ ููุชุจุฑุนุงุช:**
- โ ุงููุณุชุฎุฏููู ุงููุณุฌููู: ุชุจุฑุนุงุชูู ูุฑุจูุทุฉ ุจู user_id
- โ ุงูุถููู: ุชุจุฑุนุงุช ูุฌูููุฉ ุจุฏูู user_id
- โ ุงูุจูุงูุงุช ุชุธูุฑ ุจุดูู ุตุญูุญ ูู "ุชุจุฑุนุงุชู"

### **2. ูุนุงูุฌุฉ ูุฑูุฉ ููุงุณุชุฌุงุจุฉ:**
- โ ุฏุนู ุจููุงุช ุงุณุชุฌุงุจุฉ ูุชุนุฏุฏุฉ
- โ fallback ููุจูุงูุงุช ุงูููููุฏุฉ
- โ ุชุณุฌูู ููุตู ููุงุณุชุฌุงุจุฉ
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก

### **3. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ:**
- โ ุงูุชุจุฑุนุงุช ุชุธูุฑ ูู "ุชุจุฑุนุงุชู"
- โ ุงูุจูุงูุงุช ุชุธูุฑ ุจุดูู ุตุญูุญ
- โ ุงูุชููู ุณูุณ ููุชุณู
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก

---

## ๐ Debugging ูุญุณู

### **ุชุณุฌูู ุงูุงุณุชุฌุงุจุฉ:**
```dart
print('โ Donation response: $data');
print('โ Payment session created: sessionId=$sessionId, checkoutUrl=$checkoutUrl');
```

### **ุงูุชุญูู ูู ุงูุจูุงูุงุช:**
```dart
// ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูุน fallback
final sessionId = data['session_id'] ?? data['data']?['session_id'];
final checkoutUrl = data['checkout_url'] ?? 
                   data['data']?['checkout_url'] ?? 
                   data['payment_url'];
```

---

## ๐ ุงูุงุฎุชุจุงุฑ

### **1. ุงุฎุชุจุงุฑ ุงููุณุชุฎุฏู ุงููุณุฌู:**
1. ุชุณุฌูู ุฏุฎูู
2. ุฅูุดุงุก ุชุจุฑุน
3. ุฅุชูุงู ุงูุฏูุน
4. ุงูุชุญูู ูู:
   - โ ุงูุชุจุฑุน ูุธูุฑ ูู "ุชุจุฑุนุงุชู"
   - โ ุงูุจูุงูุงุช ุชุธูุฑ ุจุดูู ุตุญูุญ
   - โ ุงูุชุจุฑุน ูุฑุจูุท ุจู user_id

### **2. ุงุฎุชุจุงุฑ ุงูุถูู:**
1. ุนุฏู ุชุณุฌูู ุฏุฎูู
2. ุฅูุดุงุก ุชุจุฑุน ูุฌููู
3. ุฅุชูุงู ุงูุฏูุน
4. ุงูุชุญูู ูู:
   - โ ุงูุชุจุฑุน ูุชู ุฅูุดุงุคู ุจูุฌุงุญ
   - โ ูุง ูุธูุฑ ูู "ุชุจุฑุนุงุชู" (ูุฃูู ุบูุฑ ูุณุฌู)

### **3. ุงุฎุชุจุงุฑ console logs:**
```
โ Donation response: {success: true, data: {donation: {id: DN_xxx, user_id: 123}}}
โ Payment session created: sessionId=checkout_xxx, checkoutUrl=https://checkout.thawani.om/xxx
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **Endpoint ุงูุตุญูุญ:** `/api/v1/donations/with-payment` ุจุฏูุงู ูู `/api/v1/payments/create`
2. **ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ:** ุฏุนู ุจููุงุช ุงุณุชุฌุงุจุฉ ูุชุนุฏุฏุฉ ูุน fallback
3. **User linking:** ุงูุชุจุฑุนุงุช ุงูุขู ูุฑุจูุทุฉ ุจู user_id ูููุณุชุฎุฏููู ุงููุณุฌููู
4. **Debugging:** ุชุณุฌูู ููุตู ููุงุณุชุฌุงุจุฉ ูุงูุจูุงูุงุช

---

## ๐ ุงูุฎูุงุตุฉ

**ุชู ุฅุตูุงุญ ูุดููุฉ ุฑุจุท ุงูุชุจุฑุน ุจุงููุณุชุฎุฏู ุจูุฌุงุญ!** 

ุงูุขู:
- โ **Endpoint ุตุญูุญ:** `/api/v1/donations/with-payment`
- โ **ุฑุจุท ุงูุชุจุฑุน:** ูุชู ุฑุจุทู ุจู user_id ูููุณุชุฎุฏููู ุงููุณุฌููู
- โ **ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ:** ูุฑูุฉ ูุน ุฏุนู ุจููุงุช ูุชุนุฏุฏุฉ
- โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู:** ูุญุณูุฉ ูุน ุนุฑุถ ุงูุชุจุฑุนุงุช ูู "ุชุจุฑุนุงุชู"
- โ **Debugging:** ูุญุณู ูุน ุชุณุฌูู ููุตู

**ุงูุขู ุงูุชุจุฑุนุงุช ูุฑุจูุทุฉ ุจุงููุณุชุฎุฏููู ุจุดูู ุตุญูุญ!** ๐
