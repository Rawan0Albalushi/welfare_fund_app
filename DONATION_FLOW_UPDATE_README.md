# ุชุญุฏูุซ ุชุฏูู ุงูุชุจุฑุน - Donation Flow Update

## โ ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ

ุชู ุชุทุจูู ุงูุชุญุฏูุซุงุช ุงููุทููุจุฉ ุนูู ุชุฏูู ุงูุชุจุฑุน ูููุงู ูููุชุทูุจุงุช ุงูุฌุฏูุฏุฉ.

## ๐ ุงูุชุฏูู ุงูุฌุฏูุฏ

### 1. ุนูุฏ ุงูุถุบุท ุนูู "ุชุจุฑุน":

#### ุงูุฎุทูุฉ ุงูุฃููู: ุฅูุดุงุก ุฌูุณุฉ ุงูุฏูุน
```dart
// ุงุณุชุฏุนุงุก POST /api/v1/payments/create
final response = await http.post(
  Uri.parse('http://192.168.1.21:8000/api/v1/payments/create'),
  headers: {
    'Authorization': 'Bearer $token',
    'Content-Type': 'application/json',
  },
  body: jsonEncode({
    'donation_id': widget.campaignId ?? 1,
    'amount': amount,
    'donor_name': _donorNameController.text.trim(),
    'note': _noteController.text.trim(),
  }),
);
```

#### ุงูุฎุทูุฉ ุงูุซุงููุฉ: ูุชุญ CheckoutWebView
```dart
// ูุชุญ CheckoutWebView ูุน URLs ุงูุตุญูุญุฉ
CheckoutWebView(
  checkoutUrl: checkoutUrl,
  successUrl: 'http://192.168.1.21:8000/api/v1/payments/success',
  cancelUrl: 'http://192.168.1.21:8000/api/v1/payments/cancel',
)
```

#### ุงูุฎุทูุฉ ุงูุซุงูุซุฉ: ูุนุงูุฌุฉ ุงููุชุงุฆุฌ
```dart
if (result['status'] == 'success') {
  // ุงุณุชุฏุนุงุก POST /api/v1/payments/confirm
  await _confirmPayment(sessionId);
} else if (result['status'] == 'cancel') {
  // ุนุฑุถ ุฑุณุงูุฉ ุฅูุบุงุก ููุท
  _showCancelMessage();
}
```

#### ุงูุฎุทูุฉ ุงูุฑุงุจุนุฉ: ุชุฃููุฏ ุงูุฏูุน
```dart
// ุงุณุชุฏุนุงุก POST /api/v1/payments/confirm
final response = await http.post(
  Uri.parse('http://192.168.1.21:8000/api/v1/payments/confirm'),
  headers: {
    'Authorization': 'Bearer $token',
    'Content-Type': 'application/json',
  },
  body: jsonEncode({
    'session_id': sessionId,
  }),
);
```

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

### `lib/screens/checkout_webview.dart`
- WebView ุฌุฏูุฏ ูุฎุตุต ููุฏูุน
- ูุนุงูุฌุฉ ุดุงููุฉ ูุฑูุงุจุท ุงููุฌุงุญ ูุงูุฅูุบุงุก
- ุฏุนู ููููุตุงุช ุงููุฎุชููุฉ (ููุจุงูู ููุจ)
- ุฅุฑุฌุงุน ุงููุชุงุฆุฌ ุจุตูุบุฉ `{'status': 'success'/'cancel'}`

## ๐ง ุงููููุงุช ุงููุญุฏุซุฉ

### `lib/screens/donation_screen.dart`
- ุชุญุฏูุซ ุฏุงูุฉ `_makeDonation()` ูุงุณุชุฎุฏุงู API ุงูุฌุฏูุฏ
- ุฅุถุงูุฉ ุฏุงูุฉ `_confirmPayment()` ูุชุฃููุฏ ุงูุฏูุน
- ุฅุถุงูุฉ ุฏุงูุฉ `_showDonationSuccess()` ูุนุฑุถ ูุฌุงุญ ุงูุชุจุฑุน
- ุฅุถุงูุฉ ุฏุงูุฉ `_showCancelMessage()` ูุนุฑุถ ุฑุณุงูุฉ ุงูุฅูุบุงุก
- ุชุญุฏูุซ imports ูุงุณุชุฎุฏุงู `CheckoutWebView`

## ๐ URLs ุงููุณุชุฎุฏูุฉ

- **API Base:** `http://192.168.1.21:8000/api/v1`
- **Create Payment:** `POST /payments/create`
- **Confirm Payment:** `POST /payments/confirm`
- **Success URL:** `http://192.168.1.21:8000/api/v1/payments/success`
- **Cancel URL:** `http://192.168.1.21:8000/api/v1/payments/cancel`

## ๐ฑ ุฏุนู ุงูููุตุงุช

### Android (ุฌูุงุฒ ุญูููู ุฃุซูุงุก ุงูุชุทููุฑ)
```bash
adb reverse tcp:8000 tcp:8000
```
ูุฐุง ุงูุฃูุฑ ูุฑุจุท ุงููููุฐ 8000 ุนูู ุงูุฌูุงุฒ ุจุงููููุฐ 8000 ุนูู localhost.

### iOS
- ูุนูู ุชููุงุฆูุงู ูุน localhost
- ูุง ูุญุชุงุฌ ูุฃูุงูุฑ ุฅุถุงููุฉ

### Web
- ููุชุญ ุตูุญุฉ ุงูุฏูุน ูู ุงููุชุตูุญ
- ูุนุงูุฌุฉ ุชููุงุฆูุฉ ูููุชุงุฆุฌ

## โ ุงูููุฒุงุช ุงููุทุจูุฉ

1. **ุนุฏู ุฅุถุงูุฉ session_id ููู successUrl** - ููุง ูู ูุทููุจ
2. **ุงูุงุนุชูุงุฏ ุนูู session_id ุงููุฎุฒู** ูู ุงูุชุทุจูู
3. **ูุนุงูุฌุฉ ุดุงููุฉ ูุญุงูุงุช ุงููุฌุงุญ ูุงูุฅูุบุงุก**
4. **ูุงุฌูุฉ ูุณุชุฎุฏู ูุญุณูุฉ** ูุน ุฑุณุงุฆู ูุงุถุญุฉ
5. **ุฏุนู ูุชุนุฏุฏ ุงูููุตุงุช** (Android, iOS, Web)

## ๐ ุชุฏูู ุงูุนูู ุงููุงูู

1. ุงููุณุชุฎุฏู ูููุฃ ุจูุงูุงุช ุงูุชุจุฑุน
2. ุงูุถุบุท ุนูู "ุชุจุฑุน ุงูุขู"
3. ุฅูุดุงุก ุฌูุณุฉ ุฏูุน ุนุจุฑ API
4. ูุชุญ WebView ูุน ุตูุญุฉ ุงูุฏูุน
5. ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุทุฑููุฉ ุงูุฏูุน
6. ุจุนุฏ ุฅุชูุงู ุงูุฏูุน:
   - ุฅุฐุง ูุฌุญ: ุชุฃููุฏ ุงูุฏูุน + ุนุฑุถ ุดุงุดุฉ ุงููุฌุงุญ
   - ุฅุฐุง ุฃูุบู: ุนุฑุถ ุฑุณุงูุฉ ุฅูุบุงุก
7. ุงูุนูุฏุฉ ููุดุงุดุฉ ุงูุณุงุจูุฉ

## ๐ฏ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ ููุชุณูุฉ
- ูุนุงูุฌุฉ ุตุญูุญุฉ ูุฌููุน ุญุงูุงุช ุงูุฏูุน
- ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู
- ุฏุนู ูุงูู ููููุตุงุช ุงููุฎุชููุฉ
