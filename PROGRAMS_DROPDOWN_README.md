# إضافة قائمة منسدلة للبرامج في صفحة تسجيل الطالب

## نظرة عامة
تم إضافة قائمة منسدلة للبرامج في صفحة تسجيل الطالب بدلاً من حقل النص الحر. الآن يمكن للطلاب اختيار البرنامج من قائمة البرامج المتاحة من الخادم.

## التحديثات المضافة

### 1. خدمة جلب البرامج
- تم إضافة دالة `getSupportPrograms()` في `StudentRegistrationService`
- تجلب البرامج من API: `GET /api/v1/programs/support`
- تعيد قائمة من البرامج مع معرفاتها وأسمائها

### 2. تحديث صفحة تسجيل الطالب
- إضافة متغيرات جديدة لتخزين البرامج:
  - `_programs`: قائمة البرامج من الخادم
  - `_selectedProgramId`: معرف البرنامج المحدد
  - `_isLoadingPrograms`: حالة تحميل البرامج

### 3. واجهة المستخدم
- استبدال حقل النص الحر بقائمة منسدلة تفاعلية
- عرض حالة التحميل أثناء جلب البرامج
- دعم الوضع المقروء فقط (read-only)
- عرض رسائل خطأ مناسبة
- زر إعادة تحميل البرامج في حالة عدم وجود برامج

### 4. معالجة البيانات
- تحديث دالة `submitStudentRegistration` لإرسال معرف البرنامج
- تحميل البرامج عند فتح الصفحة
- حفظ وتحميل البرنامج المحدد في البيانات الموجودة

### 5. التحقق من صحة البيانات
- التحقق من وجود برامج متاحة
- التحقق من اختيار برنامج قبل التسجيل
- التحقق من صحة البرنامج المحدد
- معالجة الأخطاء وحالات الاستثناء

### 6. التوافق مع الباكند
- دعم بنية البيانات من Laravel Resource
- استخدام `title` بدلاً من `name` للتوافق مع الباكند
- تطبيع بنية البيانات للاستخدام الموحد

## الملفات المعدلة

### `lib/services/student_registration_service.dart`
```dart
// دالة جديدة لجلب البرامج
Future<List<Map<String, dynamic>>> getSupportPrograms() async {
  // تجلب البرامج من API مع التوافق مع Laravel Resource
}

// تحديث دالة التسجيل لإضافة programId
Future<Map<String, dynamic>> submitStudentRegistration({
  // ... المعاملات الموجودة
  int? programId,
}) async {
  // إرسال معرف البرنامج مع البيانات
}
```

### `lib/screens/student_registration_screen.dart`
```dart
// متغيرات جديدة
List<Map<String, dynamic>> _programs = [];
String? _selectedProgramId;
bool _isLoadingPrograms = false;

// دالة تحميل البرامج
Future<void> _loadPrograms() async {
  // جلب البرامج من الخادم مع التوافق مع الباكند
  // استخدام 'title' بدلاً من 'name'
}

// دالة إنشاء القائمة المنسدلة
Widget _buildProgramDropdown() {
  // واجهة القائمة المنسدلة مع معالجة الحالات المختلفة
}

// التحقق من صحة البيانات قبل التسجيل
void _submitRegistration() async {
  // تحققات متعددة للبيانات
}
```

## كيفية الاستخدام

### للطلاب:
1. افتح صفحة تسجيل الطالب
2. انتظر تحميل البرامج (سيظهر مؤشر التحميل)
3. اختر البرنامج المناسب من القائمة المنسدلة
4. أكمل باقي البيانات
5. اضغط على زر التسجيل

### للبيانات الموجودة:
- عند تحميل بيانات تسجيل موجودة، سيتم تحديد البرنامج تلقائياً
- في حالة عدم وجود برامج محملة، سيتم تحميلها أولاً

## معالجة الأخطاء

### أخطاء التحميل:
- عرض رسالة خطأ عند فشل تحميل البرامج
- زر إعادة تحميل البرامج
- إعادة المحاولة عند فتح الصفحة مرة أخرى

### التحقق من البيانات:
- التأكد من وجود برامج متاحة
- التأكد من اختيار برنامج قبل التسجيل
- التحقق من صحة البرنامج المحدد
- عرض رسائل خطأ واضحة ومفيدة

### حالات خاصة:
- حالة عدم وجود برامج متاحة
- حالة فشل تحميل البرامج
- حالة عدم اختيار برنامج
- حالة البرنامج غير الصحيح

## API المطلوب

### نقطة النهاية:
```
GET /api/v1/programs/support
```

### الاستجابة المتوقعة (Laravel Resource):
```json
{
  "data": [
    {
      "id": 1,
      "title": "برنامج فرص التعليم العالي",
      "description": "دعم للطلاب للحصول على فرص تعليمية أفضل",
      "goal_amount": 100000,
      "raised_amount": 50000,
      "progress_percentage": 50,
      "status": "active",
      "category": "education"
    },
    {
      "id": 2,
      "title": "برنامج السكن والنقل",
      "description": "مساعدة الطلاب في تكاليف السكن والنقل",
      "goal_amount": 75000,
      "raised_amount": 30000,
      "progress_percentage": 40,
      "status": "active",
      "category": "housing"
    }
  ]
}
```

### البرامج المتاحة:
1. **برنامج فرص التعليم العالي** - دعم للطلاب للحصول على فرص تعليمية أفضل
2. **برنامج السكن والنقل** - مساعدة الطلاب في تكاليف السكن والنقل
3. **برنامج الاعانة الشهرية** - دعم مالي شهري للطلاب المحتاجين
4. **رسوم الاختبارات** - مساعدة في تكاليف الاختبارات والامتحانات

## المزايا

1. **سهولة الاستخدام**: اختيار من قائمة بدلاً من الكتابة
2. **تقليل الأخطاء**: لا يمكن إدخال برامج غير موجودة
3. **مرونة**: إضافة برامج جديدة من الخادم دون تحديث التطبيق
4. **تجربة مستخدم محسنة**: واجهة أكثر وضوحاً وسهولة
5. **معالجة شاملة للأخطاء**: رسائل خطأ واضحة وحلول للمشاكل
6. **تحقق من صحة البيانات**: ضمان دقة البيانات المرسلة
7. **توافق كامل مع الباكند**: استخدام Laravel Resource
8. **دعم البرامج المتعددة**: 4 برامج دعم مختلفة

## ملاحظات تقنية

- يتم تحميل البرامج مرة واحدة عند فتح الصفحة
- في حالة فشل التحميل، يمكن للطالب إعادة المحاولة
- يتم حفظ معرف البرنامج مع البيانات المرسلة للخادم
- دعم كامل للوضع المقروء فقط في حالة الطلبات المعتمدة
- التحقق من صحة البيانات قبل الإرسال
- معالجة جميع حالات الاستثناء المحتملة
- توافق كامل مع بنية Laravel Resource

## الإصلاحات المضافة

### 1. إصلاح خطأ "program is required":
- تحسين التحقق من البرنامج المحدد
- إضافة تحققات متعددة للبيانات
- معالجة الحالات الاستثنائية

### 2. تحسين معالجة الأخطاء:
- رسائل خطأ أكثر وضوحاً
- حلول للمشاكل الشائعة
- تجربة مستخدم محسنة

### 3. تحسين واجهة المستخدم:
- عرض حالة التحميل
- زر إعادة تحميل البرامج
- معالجة حالة عدم وجود برامج

### 4. التوافق مع الباكند:
- دعم Laravel Resource
- استخدام `title` بدلاً من `name`
- تطبيع بنية البيانات

## الباكند المطلوب

### ✅ تم إنجازه:
- إنشاء فئة "برامج الدعم الطلابي" في قاعدة البيانات
- إضافة 4 برامج دعم مختلفة
- إصلاح بنية البيانات لتشمل جميع الحقول المطلوبة
- استخدام ProgramResource بدلاً من البيانات الخام

### بنية البيانات في الباكند:
```php
// Program Model
{
  "id": 1,
  "title": "اسم البرنامج",
  "description": "وصف البرنامج",
  "goal_amount": 100000,
  "raised_amount": 50000,
  "progress_percentage": 50,
  "status": "active",
  "category": "category_name"
}
```

### نقطة النهاية:
```php
// Routes
Route::get('/v1/programs/support', [ProgramController::class, 'getSupportPrograms']);

// Controller
public function getSupportPrograms()
{
    $programs = Program::where('status', 'active')->get();
    return ProgramResource::collection($programs);
}
```

## الحالة النهائية

✅ **تم إنجاز جميع المتطلبات بنجاح:**
- قائمة منسدلة للبرامج تعمل بشكل صحيح
- توافق كامل مع الباكند
- معالجة شاملة للأخطاء
- واجهة مستخدم محسنة
- دعم 4 برامج دعم مختلفة
