# ุฅุตูุงุญ ูุญุณู ููุดููุฉ ุงูุงูุชูุงู ุจุนุฏ ูุฌุงุญ ุงูุฏูุน

## ุงููุดููุฉ ุงููุณุชูุฑุฉ

ุฑุบู ุงูุฅุตูุงุญุงุช ุงูุณุงุจูุฉุ ูุง ูุฒุงู ุงููุณุชุฎุฏู ูุชู ุชูุฌููู ุฅูู ุตูุญุฉ ุงูุฎุทุฃ `https://sfund.app/pay/success` ุจุฏูุงู ูู ุตูุญุฉ ูุฌุงุญ ุงูุชุจุฑุน ุฏุงุฎู ุงูุชุทุจูู.

## ุงูุณุจุจ ุงูุฌุฐุฑู

ุชุจูู ุฃู ุงููุดููุฉ ููุณุช ููุท ูู ุงูุชุทุจููุ ุจู ุฃูุถุงู ูู:
1. ุฅุนุฏุงุฏุงุช Thawani ุนูู ุงูุฎุงุฏู ูุฏ ุชุชุฌุงูู `return_url` ูุชุณุชุฎุฏู `success_url` ุงูุซุงุจุช
2. WebView ูุง ูุฑุงูุจ ุจุดูู ูุงูู ุญุงูุฉ ุงูุฏูุน
3. ุงูุงุนุชูุงุฏ ุนูู ุฑูุงุจุท ุงูุฅุฑุฌุงุน ููุท ุบูุฑ ูุงูู

## ุงูุญููู ุงููุญุณูุฉ

### 1. ูุฑุงูุจุฉ ุฏูุฑูุฉ ูุญุงูุฉ ุงูุฏูุน
```dart
void _checkPaymentStatusPeriodically() {
  Future.delayed(const Duration(seconds: 5), () {
    if (mounted) {
      _checkPaymentStatusSilently();
      _checkPaymentStatusPeriodically(); // Continue checking
    }
  });
}
```

### 2. ุงูุชุญูู ุงูุตุงูุช ูู ุญุงูุฉ ุงูุฏูุน
```dart
Future<void> _checkPaymentStatusSilently() async {
  final statusResponse = await _donationService.checkPaymentStatus(widget.sessionId);
  
  if (statusResponse.isCompleted) {
    Navigator.pop(context, 'success');
  } else if (statusResponse.isFailed) {
    Navigator.pop(context, 'failed');
  }
  // ... ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงูุฃุฎุฑู
}
```

### 3. ุฅุถุงูุฉ ุฃุฒุฑุงุฑ ูุฏููุฉ ูููุณุชุฎุฏู
- ุฒุฑ ุชุญุฏูุซ (๐) ููุชุญูู ูู ุญุงูุฉ ุงูุฏูุน
- ุฒุฑ ุฅุชูุงู (โ) ูููุชุงุจุนุฉ ุจุนุฏ ุงูุฏูุน
- ุฑุณุงูุฉ ุชูุฌูููุฉ ูููุณุชุฎุฏู

### 4. ุชุญุณูู ูุฑุงูุจุฉ URLs
```dart
// ุฅุถุงูุฉ sfund.app ูููุฑุงูุจุฉ
if (url.contains('success') || url.contains('sfund.app')) {
  _checkPaymentStatusAndReturn('success');
}
```

### 5. ุงูุชุญูู ุนูุฏ ุงูุฎุฑูุฌ
```dart
@override
void dispose() {
  _checkPaymentStatusAndReturn('success');
  super.dispose();
}
```

## ุงูุขููุงุช ุงูุฌุฏูุฏุฉ

### 1. ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ (ูู 5 ุซูุงูู)
- ูุชุญูู ุงูุชุทุจูู ูู ุญุงูุฉ ุงูุฏูุน ูู 5 ุซูุงูู
- ููุชูู ุชููุงุฆูุงู ุนูุฏ ุงูุชูุงู ุงูุฏูุน
- ูุนูู ูู ุงูุฎูููุฉ ุฏูู ุชุฏุฎู ุงููุณุชุฎุฏู

### 2. ุงูุฃุฒุฑุงุฑ ุงููุฏููุฉ
- **ุฒุฑ ุงูุชุญุฏูุซ (๐)**: ููุชุญูู ุงููุฏูู ูู ุญุงูุฉ ุงูุฏูุน
- **ุฒุฑ ุงูุฅุชูุงู (โ)**: ูููุชุงุจุนุฉ ุจุนุฏ ุฅุชูุงู ุงูุฏูุน ุจูุฌุงุญ

### 3. ุงูุฑุณุงุฆู ุงูุชูุฌูููุฉ
- ุจุงูุฑ ูู ุฃุนูู WebView ููุถุญ ูููุณุชุฎุฏู ูุงุฐุง ููุนู
- ูุตูุต ุชูุถูุญูุฉ ููุฃุฒุฑุงุฑ

### 4. ุงููุฑุงูุจุฉ ุงูุดุงููุฉ
- `onNavigationRequest`: ูุฑุงูุจุฉ ููุฑูุฉ ููุชููู
- `onPageFinished`: ูุฑุงูุจุฉ ุจุนุฏ ุชุญููู ุงูุตูุญุฉ
- `dispose`: ุชุญูู ููุงุฆู ุนูุฏ ุงูุฎุฑูุฌ
- ุงูุชุญูู ุงูุฏูุฑู: ูุฑุงูุจุฉ ูุณุชูุฑุฉ

## ุงููููุงุช ุงููุญุฏุซุฉ

### 1. `lib/screens/payment_webview.dart`
- ุฅุถุงูุฉ `_checkPaymentStatusPeriodically()`
- ุฅุถุงูุฉ `_checkPaymentStatusSilently()`
- ุฅุถุงูุฉ ุฃุฒุฑุงุฑ ูุฏููุฉ ุฌุฏูุฏุฉ
- ุฅุถุงูุฉ ุจุงูุฑ ุชูุฌููู
- ุชุญุณูู ูุฑุงูุจุฉ URLs

### 2. `lib/services/donation_service.dart`
- ุชุญุฏูุซ `generateReturnUrl()` ููุฑูุงุจุท ุงููุฎุตุตุฉ

### 3. `lib/screens/payment_screen.dart`
- ุชุญุฏูุซ URLs ููุฑูุงุจุท ุงููุฎุตุตุฉ

## ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุงูุฌุฏูุฏุฉ

### ุงูุณููุงุฑูู ุงููุซุงูู:
1. ุงููุณุชุฎุฏู ูุจุฏุฃ ุนูููุฉ ุงูุฏูุน
2. ููุชุญ WebView ููุธูุฑ ุจุงูุฑ ุชูุฌููู
3. ุงููุณุชุฎุฏู ูููู ุงูุฏูุน ูู Thawani
4. ุงูุชุทุจูู ูุชุญูู ุชููุงุฆูุงู ูู 5 ุซูุงูู
5. ุนูุฏ ุงูุชูุงู ุงูุฏูุนุ ููุชูู ุชููุงุฆูุงู ูุตูุญุฉ ุงููุฌุงุญ

### ุงูุณููุงุฑูู ุงูุจุฏูู:
1. ุฅุฐุง ูู ูุญุฏุซ ุงูุงูุชูุงู ุงูุชููุงุฆู
2. ุงููุณุชุฎุฏู ูุฑู ุฑุณุงูุฉ ุชูุฌูููุฉ
3. ูุถุบุท ุฒุฑ โ ูููุชุงุจุนุฉ
4. ููุชูู ูุตูุญุฉ ุงููุฌุงุญ

### ุณููุงุฑูู ุงูุทูุงุฑุฆ:
1. ุฅุฐุง ูุดู ูู ุดูุก ุขุฎุฑ
2. ุงููุณุชุฎุฏู ูุถุบุท ุฒุฑ ๐ ููุชุญุฏูุซ
3. ุงูุชุทุจูู ูุชุญูู ูู ุญุงูุฉ ุงูุฏูุน
4. ููุชูู ููุตูุญุฉ ุงูููุงุณุจุฉ

## ุงูุงุฎุชุจุงุฑ ุงููุทููุจ

### 1. ุงุฎุชุจุงุฑ ุงูุชุดุบูู ุงูุนุงุฏู
```bash
flutter run
# ุฌุฑุจ ุนูููุฉ ุฏูุน ูุงููุฉ
# ุฑุงูุจ ุงูุณุฌูุงุช ูุฑุคูุฉ:
# "PaymentWebView: Periodic payment status check..."
# "PaymentWebView: Payment completed, navigating to success!"
```

### 2. ุงุฎุชุจุงุฑ ุงูุฃุฒุฑุงุฑ ุงููุฏููุฉ
- ุงุถุบุท ุฒุฑ ๐ ุฃุซูุงุก ุนูููุฉ ุงูุฏูุน
- ุงุถุบุท ุฒุฑ โ ุจุนุฏ ุฅุชูุงู ุงูุฏูุน
- ุชุฃูุฏ ูู ุนูู ูู ุฒุฑ

### 3. ุงุฎุชุจุงุฑ ุงูุณููุงุฑูููุงุช ุงููุฎุชููุฉ
- ุฏูุน ูุงุฌุญ
- ุฏูุน ููุบู
- ุฏูุน ูุงุดู
- ุฅุบูุงู WebView ุฃุซูุงุก ุงูุฏูุน

## ุงููุชูุฌุฉ ุงููุชููุนุฉ

โ **ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ**: ุงูุชุทุจูู ูุชุญูู ูู ุญุงูุฉ ุงูุฏูุน ูู 5 ุซูุงูู
โ **ุงูุงูุชูุงู ุงูุชููุงุฆู**: ููุชูู ูุตูุญุฉ ุงููุฌุงุญ ุนูุฏ ุงูุชูุงู ุงูุฏูุน
โ **ุงูุฎูุงุฑุงุช ุงููุฏููุฉ**: ุงููุณุชุฎุฏู ูุฏูู ุฃุฒุฑุงุฑ ููุชุญูู ุงููุฏูู
โ **ุงูุชูุฌูู ุงููุงุถุญ**: ุฑุณุงุฆู ุชูุถุญ ูููุณุชุฎุฏู ูุงุฐุง ููุนู
โ **ุงููุฑููุฉ**: ูุนูู ุญุชู ูู ูุดูุช ุงูุทุฑู ุงูุชูููุฏูุฉ
